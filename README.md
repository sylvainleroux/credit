# Credit :: Outils de calculs pour prêts immobiliers

Modèle Json
-----------

```
{
  "prets": [  // Liste des prets modélisés
    {
      "nom": "PRET1", // Nom du prêt
      "nominal": 2500, // Montant à financer
      "debut": "2011-01-01", // Echéance #0
      "echeances": [ // Liste de série d'échéances. 
        {"debut": 1, "fin": 24, "montant": 10, "taux": 0.00 }
      ],
      "assurances": [
        {"debut": 1, "fin": 24, "capital": 2500, "taux": 0.003 }
      ]
    },
    {
      "nom": "PRET2",
      "nominal": 30000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut": 1, "fin": 120, "montant": 297.18, "taux": 0.03}
      ],
      "assurances": [
        { "debut": 1, "fin": 120, "capital": 30000, "taux": 0.003 }
      ],
      "strategies":[
     	 { "nom" : "split",  "split_after" : 20},
      	{ "nom" : "length", "nb_mois" : 50, "taux": 0.017, "taux_assurance": 0.001}
      ]
    },
    {
      "nom": "PRET3",
      "nominal": 40000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut":   1, "fin":  168, "montant": 324, "taux": 0.04 }
        
      ],
      "assurances": [
        { "debut": 1, "fin": 168, "capital": 40000, "taux": 0.004 }
      ],
      "strategies":[
      	 { "nom" : "split",  "split_after" : 20},
      	{ "nom" : "lissage-mensualite", "mensualite_cible" : 730, "taux" : 0.040, "taux_assurance" : "0.004"}
      ]
    }
  ]
}
```

* pret.echeances : Séries d'échéances, chaque série définit un période allant du terme `début`au terme `fin`, pendant laquelle le taux `taux` est appliqué, et pendant laquelle les mensualités ont comme valeur `montant`
* pret.assurances : Assurances, Chaque assurance définit une période par `début` et `fin`, pendant laquelle le `capital` est assuré au taux `taux`
* pret.strategies : les stratégies permettent d'agir sur les paramètres du prêt, par example ajuster la durée pour obtenir une mensualité cible, ou d'effectuer un lissage. Après exécution des stratégies, un nouveau tableau d'amortissement est affiché.

Strategies
----------

* Lissage avec une mensualité cible : s'applique sur le dernier prêt, ajuste la durée du prêt pour obtenir des mensualités constantes pendant toute la durée du prêt, tous prêts confondus.
```
{ "nom" : "lissage-mensualite", "mensualite_cible" : 678, "taux" : 0.0120, "taux_assurance" : "0.0027" }
```
* Lissage avec une durée cible : s'applique sur le dernier prêt, ajuste le montant des mensualités pour obtenir une durée cible en nombre de mois.
```
{ "nom" : "lissage-duree", "duree_cible" : 143, "taux" : 0.0135, "taux_assurance" : "0.0027" }
```
* Split : permet de travailler sur un tableau d'amortissement complet exisant, définit la mensualité après laquelle la durée et la mensualité peuvent varié, utile pour une renégociation de crédit pour laquelle les mensualité précédant la date de renégociation doivent rester inchangées. S'applique à tous les prêts concernés par la renégociation.
```
{ "nom" : "split",  "split_after" : 50 },
{ "nom" : "lissage-mensualite", "mensualite_cible" : 841, "taux" : 0.020, "taux_assurance" : "0.002"}
```
* Apport : Apport de capital, pour amotissement du crédit au terme précisé.
```
{ "nom" : "apport", "montant" : 3400, "terme" : 51},
```
* Length : Ajuste la duree d'un prêt
```
{ "nom" : "length", "nb_mois" : 108, "taux" : 0.017, "taux_assurance" : "0.002" }
```

Renégociation de crédit 
-----------------------

* Entrer les paramètres du crédit original : le tableau d'ammortissement doit correspondre
```
{
  "prets": [
    {
      "nom": "PRET1", 
      "nominal": 2500,
      "debut": "2011-01-01",
      "echeances": [
        {"debut":   1,  "fin": 23, "montant": 104.80, "taux": 0.000 },
        {"debut":   24, "fin": 24, "montant": 104.72, "taux": 0.000 }
      ],
      "assurances": [
        {"debut": 1, "fin": 24, "capital": 2500, "taux": 0.003 }
      ]
    },
    {
      "nom": "PRET2",
      "nominal": 20000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut": 1, "fin": 49, "montant": 442.42, "taux": 0.04},
        { "debut": 50,"fin": 50, "montant": 442.62, "taux": 0.04}
      ],
      "assurances": [
        { "debut": 1, "fin": 50, "capital": 30000, "taux": 0.003 }
      ]
    },
    {
      "nom": "PRET3",
      "nominal": 40000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut":   1, "fin":  24, "montant": 256.98, "taux": 0.04 },
        { "debut":   25, "fin":  50, "montant": 363.78, "taux": 0.04 },
        { "debut":   51, "fin":  91, "montant": 805.46, "taux": 0.04 },
        { "debut":   92, "fin":  92, "montant": 813.75, "taux": 0.04 }
      ],
      "assurances": [
        { "debut": 1, "fin": 92, "capital": 40000, "taux": 0.004 } 
      ]
    }
  ]
}
```
* Définir la mensualité de départ des renégociations : ajouter la stratégie "split" sur les 2 derniers prêts
* Ajuster la durée du second prêt : stratégie "length"
* Lisser avec le troisième prêt, stratégies "lissage-duree" ou "lissage-mensualite"
```
{
  "prets": [
    {
      "nom": "PRET1", 
      "nominal": 2500,
      "debut": "2011-01-01",
      "echeances": [
        {"debut":   1,  "fin": 23, "montant": 104.80, "taux": 0.000 },
        {"debut":   24, "fin": 24, "montant": 104.72, "taux": 0.000 }
      ],
      "assurances": [
        {"debut": 1, "fin": 24, "capital": 2500, "taux": 0.003 }
      ]
    },
    {
      "nom": "PRET2",
      "nominal": 20000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut": 1, "fin": 49, "montant": 442.42, "taux": 0.04},
        { "debut": 50,"fin": 50, "montant": 442.62, "taux": 0.04}
      ],
      "assurances": [
        { "debut": 1, "fin": 50, "capital": 30000, "taux": 0.003 }
      ],
      "strategies":[
      	{ "nom" : "split", "split_after" : 16 },
      	{ "nom" : "length", "nb_mois" : 44, "taux" : 0.02, "taux_assurance" : "0.003" }
      ]
    },
    {
      "nom": "PRET3",
      "nominal": 40000,
      "debut": "2011-01-01",
      "echeances": [
        { "debut":   1, "fin":  24, "montant": 256.98, "taux": 0.04 },
        { "debut":   25, "fin":  50, "montant": 363.78, "taux": 0.04 },
        { "debut":   51, "fin":  91, "montant": 805.46, "taux": 0.04 },
        { "debut":   92, "fin":  92, "montant": 813.75, "taux": 0.04 }
      ],
      "assurances": [
        { "debut": 1, "fin": 92, "capital": 40000, "taux": 0.004 } 
      ],
      "strategies":[
      	{ "nom" : "split",  "split_after" : 16 },
      	{ "nom" : "lissage-mensualite", "mensualite_cible" : 800, "taux" : 0.03, "taux_assurance" : "0.002"}
      ]
    }
  ]
}
```

Exemple : 
```
Pass a filename as parameter. Using default file
[PRET2] Augmente la mensualité jusqu'à obtenir la durée choisie[PRET2] Echeances :
  1 -  16 : 442.42 
 17 -  44 :   1.00 
[PRET2] Assurances :
  1 -  16 : 30000.00 

 17 -  44 : 13953.41 

................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
[PRET2] Ajuste les menusualités pour avoir des menusalités égales (scale:1) 
[PRET2] Ajuste les menusualités pour avoir des menusalités égales (scale:0.1) --
[PRET2] Ajuste les menusualités pour avoir des menusalités égales (scale:0.01) ----------
[PRET2] Echeances :
  1 -  16 : 442.42 
 17 -  43 : 512.55 
 44 -  44 : 511.59 
[PRET3] Echeances :
  1 -  16 : 256.98 
[PRET3] Création séries de paiement pour lissage
[PRET3] Ajuste le nombre de menusalités +++++++++++++++++++++++++++++++++++++++++++++--
[PRET3] Ajuste les menusualités pour avoir des menusalités égales (scale:1) ++++++++++++++
[PRET3] Ajuste les menusualités pour avoir des menusalités égales (scale:0.1) +++++
[PRET3] Ajuste les menusualités pour avoir des menusalités égales (scale:0.01) +++++++++++
[PRET3] Echeances :
  1 -  16 : 256.98 
 17 -  23 : 182.65 
 24 -  24 : 182.73 
 25 -  44 : 287.45 
 45 -  87 : 814.61 
 88 -  88 : 815.27 
[PRET1] Echeances :
  1 -  23 : 104.80 
 24 -  24 : 104.72 
[PRET1] Tableau d'amortissement : 
terme        date  interets     assur  cp remb.  cp rest.  echeance
    0                  0.00      0.00      0.00   2500.00      0.00
    1  01/01/2011      0.00      0.63    104.17   2395.83    104.80
    2  01/02/2011      0.00      0.63    104.17   2291.66    104.80
    3  01/03/2011      0.00      0.63    104.17   2187.49    104.80
    4  01/04/2011      0.00      0.63    104.17   2083.32    104.80
    5  01/05/2011      0.00      0.63    104.17   1979.15    104.80
    6  01/06/2011      0.00      0.63    104.17   1874.98    104.80
    7  01/07/2011      0.00      0.63    104.17   1770.81    104.80
    8  01/08/2011      0.00      0.63    104.17   1666.64    104.80
    9  01/09/2011      0.00      0.63    104.17   1562.47    104.80
   10  01/10/2011      0.00      0.63    104.17   1458.30    104.80
   11  01/11/2011      0.00      0.63    104.17   1354.13    104.80
   12  01/12/2011      0.00      0.63    104.17   1249.96    104.80
   13  01/01/2012      0.00      0.63    104.17   1145.79    104.80
   14  01/02/2012      0.00      0.63    104.17   1041.62    104.80
   15  01/03/2012      0.00      0.63    104.17    937.45    104.80
   16  01/04/2012      0.00      0.63    104.17    833.28    104.80
   17  01/05/2012      0.00      0.63    104.17    729.11    104.80
   18  01/06/2012      0.00      0.63    104.17    624.94    104.80
   19  01/07/2012      0.00      0.63    104.17    520.77    104.80
   20  01/08/2012      0.00      0.63    104.17    416.60    104.80
   21  01/09/2012      0.00      0.63    104.17    312.43    104.80
   22  01/10/2012      0.00      0.63    104.17    208.26    104.80
   23  01/11/2012      0.00      0.63    104.17    104.09    104.80
   24  01/12/2012      0.00      0.63    104.09      0.00    104.72
[PRET2] Echeances :
  1 -  16 : 442.42 
 17 -  43 : 512.55 
 44 -  44 : 511.59 
[PRET2] Tableau d'amortissement : 
terme        date  interets     assur  cp remb.  cp rest.  echeance
    0                  0.00      0.00      0.00  20000.00      0.00
    1  01/01/2011     66.67      5.63    370.12  19629.88    442.42
    2  01/02/2011     65.43      5.63    371.36  19258.52    442.42
    3  01/03/2011     64.20      5.63    372.59  18885.93    442.42
    4  01/04/2011     62.95      5.63    373.84  18512.09    442.42
    5  01/05/2011     61.71      5.63    375.08  18137.01    442.42
    6  01/06/2011     60.46      5.63    376.33  17760.68    442.42
    7  01/07/2011     59.20      5.63    377.59  17383.09    442.42
    8  01/08/2011     57.94      5.63    378.85  17004.24    442.42
    9  01/09/2011     56.68      5.63    380.11  16624.13    442.42
   10  01/10/2011     55.41      5.63    381.38  16242.75    442.42
   11  01/11/2011     54.14      5.63    382.65  15860.10    442.42
   12  01/12/2011     52.87      5.63    383.92  15476.18    442.42
   13  01/01/2012     51.59      5.63    385.20  15090.98    442.42
   14  01/02/2012     50.30      5.63    386.49  14704.49    442.42
   15  01/03/2012     49.01      5.63    387.78  14316.71    442.42
   16  01/04/2012     47.72      5.63    389.07  13927.64    442.42
   17  01/05/2012     23.21      2.99    486.35  13441.29    512.55
   18  01/06/2012     22.40      2.99    487.16  12954.13    512.55
   19  01/07/2012     21.59      2.99    487.97  12466.16    512.55
   20  01/08/2012     20.78      2.99    488.78  11977.38    512.55
   21  01/09/2012     19.96      2.99    489.60  11487.78    512.55
   22  01/10/2012     19.15      2.99    490.41  10997.37    512.55
   23  01/11/2012     18.33      2.99    491.23  10506.14    512.55
   24  01/12/2012     17.51      2.99    492.05  10014.09    512.55
   25  01/01/2013     16.69      2.99    492.87   9521.22    512.55
   26  01/02/2013     15.87      2.99    493.69   9027.53    512.55
   27  01/03/2013     15.05      2.99    494.51   8533.02    512.55
   28  01/04/2013     14.22      2.99    495.34   8037.68    512.55
   29  01/05/2013     13.40      2.99    496.16   7541.52    512.55
   30  01/06/2013     12.57      2.99    496.99   7044.53    512.55
   31  01/07/2013     11.74      2.99    497.82   6546.71    512.55
   32  01/08/2013     10.91      2.99    498.65   6048.06    512.55
   33  01/09/2013     10.08      2.99    499.48   5548.58    512.55
   34  01/10/2013      9.25      2.99    500.31   5048.27    512.55
   35  01/11/2013      8.41      2.99    501.15   4547.12    512.55
   36  01/12/2013      7.58      2.99    501.98   4045.14    512.55
   37  01/01/2014      6.74      2.99    502.82   3542.32    512.55
   38  01/02/2014      5.90      2.99    503.66   3038.66    512.55
   39  01/03/2014      5.06      2.99    504.50   2534.16    512.55
   40  01/04/2014      4.22      2.99    505.34   2028.82    512.55
   41  01/05/2014      3.38      2.99    506.18   1522.64    512.55
   42  01/06/2014      2.54      2.99    507.02   1015.62    512.55
   43  01/07/2014      1.69      2.99    507.87    507.75    512.55
   44  01/08/2014      0.85      2.99    507.75      0.00    511.59
[PRET3] Echeances :
  1 -  16 : 256.98 
 17 -  23 : 182.65 
 24 -  24 : 182.73 
 25 -  44 : 287.45 
 45 -  87 : 814.61 
 88 -  88 : 815.27 
[PRET3] Tableau d'amortissement : 
terme        date  interets     assur  cp remb.  cp rest.  echeance
    0                  0.00      0.00      0.00  40000.00      0.00
    1  01/01/2011    133.33     10.00    113.65  39886.35    256.98
    2  01/02/2011    132.95     10.00    114.03  39772.32    256.98
    3  01/03/2011    132.57     10.00    114.41  39657.91    256.98
    4  01/04/2011    132.19     10.00    114.79  39543.12    256.98
    5  01/05/2011    131.81     10.00    115.17  39427.95    256.98
    6  01/06/2011    131.43     10.00    115.55  39312.40    256.98
    7  01/07/2011    131.04     10.00    115.94  39196.46    256.98
    8  01/08/2011    130.65     10.00    116.33  39080.13    256.98
    9  01/09/2011    130.27     10.00    116.71  38963.42    256.98
   10  01/10/2011    129.88     10.00    117.10  38846.32    256.98
   11  01/11/2011    129.49     10.00    117.49  38728.83    256.98
   12  01/12/2011    129.10     10.00    117.88  38610.95    256.98
   13  01/01/2012    128.70     10.00    118.28  38492.67    256.98
   14  01/02/2012    128.31     10.00    118.67  38374.00    256.98
   15  01/03/2012    127.91     10.00    119.07  38254.93    256.98
   16  01/04/2012    127.52     10.00    119.46  38135.47    256.98
   17  01/05/2012     95.34      6.27     81.04  38054.43    182.65
   18  01/06/2012     95.14      6.27     81.24  37973.19    182.65
   19  01/07/2012     94.93      6.27     81.45  37891.74    182.65
   20  01/08/2012     94.73      6.27     81.65  37810.09    182.65
   21  01/09/2012     94.53      6.27     81.85  37728.24    182.65
   22  01/10/2012     94.32      6.27     82.06  37646.18    182.65
   23  01/11/2012     94.12      6.27     82.26  37563.92    182.65
   24  01/12/2012     93.91      6.27     82.55  37481.37    182.73
   25  01/01/2013     93.70      6.27    187.48  37293.89    287.45
   26  01/02/2013     93.23      6.27    187.95  37105.94    287.45
   27  01/03/2013     92.76      6.27    188.42  36917.52    287.45
   28  01/04/2013     92.29      6.27    188.89  36728.63    287.45
   29  01/05/2013     91.82      6.27    189.36  36539.27    287.45
   30  01/06/2013     91.35      6.27    189.83  36349.44    287.45
   31  01/07/2013     90.87      6.27    190.31  36159.13    287.45
   32  01/08/2013     90.40      6.27    190.78  35968.35    287.45
   33  01/09/2013     89.92      6.27    191.26  35777.09    287.45
   34  01/10/2013     89.44      6.27    191.74  35585.35    287.45
   35  01/11/2013     88.96      6.27    192.22  35393.13    287.45
   36  01/12/2013     88.48      6.27    192.70  35200.43    287.45
   37  01/01/2014     88.00      6.27    193.18  35007.25    287.45
   38  01/02/2014     87.52      6.27    193.66  34813.59    287.45
   39  01/03/2014     87.03      6.27    194.15  34619.44    287.45
   40  01/04/2014     86.55      6.27    194.63  34424.81    287.45
   41  01/05/2014     86.06      6.27    195.12  34229.69    287.45
   42  01/06/2014     85.57      6.27    195.61  34034.08    287.45
   43  01/07/2014     85.09      6.27    196.09  33837.99    287.45
   44  01/08/2014     84.59      6.27    196.59  33641.40    287.45
   45  01/09/2014     84.10      6.27    724.24  32917.16    814.61
   46  01/10/2014     82.29      6.27    726.05  32191.11    814.61
   47  01/11/2014     80.48      6.27    727.86  31463.25    814.61
   48  01/12/2014     78.66      6.27    729.68  30733.57    814.61
   49  01/01/2015     76.83      6.27    731.51  30002.06    814.61
   50  01/02/2015     75.01      6.27    733.33  29268.73    814.61
   51  01/03/2015     73.17      6.27    735.17  28533.56    814.61
   52  01/04/2015     71.33      6.27    737.01  27796.55    814.61
   53  01/05/2015     69.49      6.27    738.85  27057.70    814.61
   54  01/06/2015     67.64      6.27    740.70  26317.00    814.61
   55  01/07/2015     65.79      6.27    742.55  25574.45    814.61
   56  01/08/2015     63.94      6.27    744.40  24830.05    814.61
   57  01/09/2015     62.08      6.27    746.26  24083.79    814.61
   58  01/10/2015     60.21      6.27    748.13  23335.66    814.61
   59  01/11/2015     58.34      6.27    750.00  22585.66    814.61
   60  01/12/2015     56.46      6.27    751.88  21833.78    814.61
   61  01/01/2016     54.58      6.27    753.76  21080.02    814.61
   62  01/02/2016     52.70      6.27    755.64  20324.38    814.61
   63  01/03/2016     50.81      6.27    757.53  19566.85    814.61
   64  01/04/2016     48.92      6.27    759.42  18807.43    814.61
   65  01/05/2016     47.02      6.27    761.32  18046.11    814.61
   66  01/06/2016     45.12      6.27    763.22  17282.89    814.61
   67  01/07/2016     43.21      6.27    765.13  16517.76    814.61
   68  01/08/2016     41.29      6.27    767.05  15750.71    814.61
   69  01/09/2016     39.38      6.27    768.96  14981.75    814.61
   70  01/10/2016     37.45      6.27    770.89  14210.86    814.61
   71  01/11/2016     35.53      6.27    772.81  13438.05    814.61
   72  01/12/2016     33.60      6.27    774.74  12663.31    814.61
   73  01/01/2017     31.66      6.27    776.68  11886.63    814.61
   74  01/02/2017     29.72      6.27    778.62  11108.01    814.61
   75  01/03/2017     27.77      6.27    780.57  10327.44    814.61
   76  01/04/2017     25.82      6.27    782.52   9544.92    814.61
   77  01/05/2017     23.86      6.27    784.48   8760.44    814.61
   78  01/06/2017     21.90      6.27    786.44   7974.00    814.61
   79  01/07/2017     19.94      6.27    788.40   7185.60    814.61
   80  01/08/2017     17.96      6.27    790.38   6395.22    814.61
   81  01/09/2017     15.99      6.27    792.35   5602.87    814.61
   82  01/10/2017     14.01      6.27    794.33   4808.54    814.61
   83  01/11/2017     12.02      6.27    796.32   4012.22    814.61
   84  01/12/2017     10.03      6.27    798.31   3213.91    814.61
   85  01/01/2018      8.03      6.27    800.31   2413.60    814.61
   86  01/02/2018      6.03      6.27    802.31   1611.29    814.61
   87  01/03/2018      4.03      6.27    804.31    806.98    814.61
   88  01/04/2018      2.02      6.27    806.98      0.00    815.27
[Total] Mensualités
  1	 16	804.20	01/01/2011	01/04/2012
 17	 43	800.00	01/05/2012	01/07/2014
 44	 44	799.04	01/08/2014	01/08/2014
 45	 87	814.61	01/09/2014	01/03/2018
 88	 88	815.27	01/04/2018	01/04/2018
= TOTAL ============================================================================
[PRET1               ] Intérêts :     0.00  Assurance :    15.12  Capital :  2500.00
[PRET2               ] Intérêts :  1255.36  Assurance :   173.80  Capital : 20000.00
[PRET3               ] Intérêts :  6554.02  Assurance :   611.44  Capital : 40000.00
TOTAL CAPITAL    : 62500.00
TOTAL INTERETS   : 7809.38
TOTAL ASSURANCES : 800.36
COUT CREDIT      : 8609.74
COUT TOTAL       : 71109.74
CHECKSUM         : 71109.74
```
